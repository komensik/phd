{"title":"data_prep","markdown":{"yaml":{"title":"data_prep","format":"html","editor":"visual"},"headingText":"Load packages","containsRefs":false,"markdown":"\n\n```{r setup}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(readr)\nlibrary(janitor)   # for clean_names()\nlibrary(tibble)\nlibrary(stringr)\nlibrary(gt)\n\n\n\n```\n\n## 0. Preliminary - Load Data +s Troubleshoot\n\n```{r}\n# Unzip and load data\n\nraw_data <- read_csv(\"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/data/raw/scotg_results.csv\")\n\nraw_data <- clean_names(raw_data)\n```\n\n### Create Codebook\n\n```{r}\n# Identify Q4 binary columns in the raw data\nq4_binary_cols <- names(raw_data)[str_detect(names(raw_data), \"^Q4_\\\\d+_\\\\d+$\")]\n\n# Create initial codebook with Q4 metadata\nq4_codebook <- tibble(\n  variable_name = q4_binary_cols\n) %>%\n  mutate(\n    statement_number = str_extract(variable_name, \"(?<=Q4_)\\\\d+(?=_)\"),\n    response_option_code = str_extract(variable_name, \"(?<=_)\\\\d+$\"),\n    response_option = case_when(\n      response_option_code == \"1\" ~ \"You\",\n      response_option_code == \"2\" ~ \"Someone you know well\",\n      response_option_code == \"3\" ~ \"No/Don't know\",\n      TRUE ~ NA_character_\n    ),\n    type = \"Binary (0/1)\",\n    values = \"1 = selected, 0 = not selected, NA = no response\",\n    notes = \"From Q4 matrix question (multiple selection possible)\"\n  )\n\n# Save this codebook to disk\nwrite_csv(q4_codebook, \"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/codebook_q4.csv\")\n\nx\n```\n\n#### 0a. troubleshooting to figure out how different question types exported\n\n# (Removed early troubleshooting code for block assignment using col indices 998â€“1000;\n\n# now using named columns like FL_8_DO_Deserving&PowerBlockA)\n\n## 1. Cleaning + Creating Codebook\n\n#### a. Label Deserving & Power Blocks\n\n```{r}\n\n# DeservingPower Blocks\n\n\nFL_8_DO_Deserving&PowerBlockA %in% names(raw_data)\n\n# Add participant block label (group a, b, c)\nraw_data <- raw_data %>%\n  mutate(\n    block = case_when(\n      !is.na(`FL_8_DO_Deserving&PowerBlockA`) ~ \"A\",\n      !is.na(`FL_8_DO_Deserving&PowerBlockB`) ~ \"B\",\n      !is.na(`FL_8_DO_Deserving&PowerBlockC`) ~ \"C\",\n      TRUE ~ NA_character_\n    )\n  )\n\n# Save labeled but otherwise unmodified version\nwrite_csv(raw_data, \"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/data/cleaned/labeled_raw_data.csv\")\n\n```\n\n#### b. Create cleaned data frame, deleting un-needed cols\n\n```{r}\n\ncolumns_to_drop <- c(\n  \"Status\", \"StartDate\", \"EndDate\", \"IPAddress\", \"RecipientLastName\", \"RecipientFirstName\", \n  \"RecipientEmail\", \"ExternalReference\", \"RecordedDate\", \"LocationLatitude\", \n  \"LocationLongitude\", \"DistributionChannel\", \"UserLanguage\"\n)\n\n# Drop all columns containing \"_DO\" (Display Order)\ndo_columns <- grep(\"_DO\", names(raw_data), value = TRUE)\n\n# Combine and remove\nraw_data_cleaned <- raw_data %>%\n  select(-all_of(c(columns_to_drop, do_columns)))\n\n```\n\n### c. Clean: drop non-consenters\n\n```{r}\n\n# Filter to those who consented\nraw_data_cleaned <- raw_data_cleaned %>%\n  filter(`Consent:` == 1)\n\n# Save again\nwrite_csv(raw_data_cleaned, \"data/cleaned/cleaned_data_consent.csv\")\n\n#remove consent col\n\nraw_data_cleaned <- raw_data_cleaned %>%\n  select(-`Consent:`)\n\n```\n\n### d. Clean: attn checks\n\n-   first, create flags for passed/not each check and people who failed all\n\n```{r}\n\n# 1. Individual pass/fail checks (already defined earlier in your script)\nattn_check_q9 <- raw_data_cleaned$Q9 == 4\n\nattn_text <- tolower(str_trim(raw_data_cleaned$Q17))\naccepted_variants <- c(\"purple\", \"\\\"purple\\\"\", \"purpke\", \"purplee\", \"prurprle\", \"purpl\", \"purp\", \"ðŸ’œ\", \"ðŸŸ£\")\nattn_check_q17 <- attn_text %in% accepted_variants\n\nattn_check_q1114 <- raw_data_cleaned$Q114_4 == 6\nattn_check_q1114[raw_data_cleaned$Q114_4 == -99] <- FALSE\nattn_check_q1114[is.na(raw_data_cleaned$Q114_4)] <- TRUE  # not shown â†’ pass\n\n# 2. Create score + filter full failures\nraw_data_cleaned <- raw_data_cleaned %>%\n  mutate(\n    attn_q9_pass = attn_check_q9,\n    attn_q17_pass = attn_check_q17,\n    attn_q1114_pass = attn_check_q1114,\n    attn_pass_count = as.integer(attn_q9_pass) + as.integer(attn_q17_pass) + as.integer(attn_q1114_pass)\n  ) %>%\n  filter(attn_pass_count > 0)  # Remove only people who failed all\n\n```\n\n### e. Clean: via survey duration\n\n```{r}\n\nstr(raw_data_cleaned$`Duration (in seconds)`)\n\nraw_data_cleaned$duration_sec <- as.numeric(raw_data_cleaned$`Duration (in seconds)`)\n\nraw_data_cleaned <- raw_data_cleaned %>%\n  filter(duration_sec >= 480)\n\n```\n\n### e. Clean: ppl who do not answer my IV ??\n\n```{r}\n\n\n\n```\n\n### f. Rename variables\n\n```{r}\nsummary(raw_data_cleaned)\n#party\n\n\n# let's see how it looks\ntable(original = df$gender, new = df$gender_01)\n\n```\n\n## 2. Deservingness and Power consolidation\n\nObjective: consolidate blocks (so only 1 Incarcerated People/Prisoners)\n\n```{r}\n\nmapping <- read_csv(\"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/data/Unified_Deserving_Power_Target_Mapping.csv\")\nraw_data_preserved <- raw_data_cleaned  # back up before modification\n\n\n\n```\n\nPrep by converting to numeric\n\n```{r}\n#| eval: false\n#| include: false\n# Identify all Deserving and Power columns\ndeserving_power_cols <- names(raw_data_cleaned)[str_detect(names(raw_data_cleaned), \"^(Deserving|Power) Group\")]\n\nraw_data_cleaned <- raw_data_cleaned %>%\n  mutate(across(\n    all_of(deserving_power_cols),\n    as.character\n  ))\n\nraw_data_cleaned <- raw_data_cleaned %>%\n  mutate(across(\n    all_of(deserving_power_cols),\n    ~ as.numeric(na_if(.x, \"-99\"))\n  ))\n\ntable(raw_data_cleaned$`Deserving Group A_1`, useNA = \"always\")\n\n```\n\nALL Evals: Create consolidated variable names for deservingness\n\n```{r}\n\nnew_vars <- c(\n  \"d_black_afam_abc\", \"d_native_ind_abc\", \"d_asianam_abc\", \"d_latino_his_abc\", \"d_whiteam_abc\", \n  \"d_mideastam_abc\", \"d_incwomen_abc\", \"d_collegewom_abc\", \"d_enviro_abc\", \"d_feminists_abc\", \n  \"d_proabort_choice_abc\", \"d_abortprov_abc\", \"d_welfare_tanf_abc\", \"d_fstamps_snap_abc\", \n  \"d_unions_abc\", \"d_medicaid_abc\", \"d_medicare_abc\", \"d_unemployed_abc\", \"d_police_abc\", \n  \"d_poorfam_abc\", \"d_wealthy_abc\", \"d_teachers_abc\", \"d_sci_experts_abc\", \"d_child_abc\", \n  \"d_crim_abc\", \"d_incppl_abc\", \"d_homeless_abc\", \"d_immigrants_abc\", \"d_unauth_undoc_abc\", \n  \"d_gunowners_abc\", \"d_voters_abc\", \"d_lgbt_abc\", \"d_trans_abc\", \"d_transkids_abc\", \"d_gunmans_abc\", \n  \"d_ice_abc\", \"d_socmed_abc\", \"d_nra_abc\", \"d_bigbank_abc\", \"d_bigcorp_abc\", \"d_uni_abc\", \n  \"d_comcoll_abc\", \"d_noncit_parent_a\", \"d_incparents_a\", \"d_hsteen_a\", \"d_athiest_a\", \"d_cath_a\", \n  \"d_evan_a\", \"d_jews_a\", \"d_pal_a\", \"d_muslim_a\", \"d_blackwom_a\", \"d_blackmen_a\", \"d_lds_a\", \n  \"d_longcov_a\", \"d_exon_a\", \"d_weed_a\", \"d_opioid_a\", \"d_whitecol_a\", \"d_tech_a\", \"d_smokers_a\", \n  \"d_genx_a\", \"d_boomer_a\", \"d_mill_a\", \"d_genz_a\"\n)\n\nfor (var in new_vars) {\n  raw_data_cleaned[[var]] <- NA #to initialize\n}\n\nView(raw_data_cleaned)\n\n```\n\n```{r}\n# Load the spreadsheet with the mappings\nlibrary(readxl)\nmapping <- read_excel(\"scratch for consolidation.xlsx\")\n\n# Loop through each row of the mapping\nfor (i in 1:nrow(mapping)) {\n  \n  new_var <- mapping$target_slug[i]\n  \n  # Get up to three source columns\n  cols_to_check <- c(mapping$`Deserving Group A`[i],\n                     mapping$`Deserving Group B`[i],\n                     mapping$`Deserving Group C`[i])\n  \n  # Remove any NA column names\n  cols_to_check <- cols_to_check[!is.na(cols_to_check)]\n  \n  # Consolidate non-NA and non--99 values across the 3 group columns\n  raw_data_cleaned[[new_var]] <- apply(\n    raw_data_cleaned[ , cols_to_check], 1, function(row) {\n      # Filter out NA and -99\n      val <- row[!is.na(row) & row != -99]\n      if (length(val) > 0) val[1] else NA  # take first valid value\n    }\n  )\n}\nc)\n\n```\n\ncheck that this worked. want to:\n\n-   EX: for observation \\[response ID\\] \\[R_7oC8AaiF6X3vmsT\\], IF they have non-NA, non -99 value in \\[Deserving Group A_1\\]\n\n    -   then they should also have \"A\" in block variable\n\n    -   the value of \\[d_black_afam_abc\\] should be = to the value of \\[Deserving Group A_1\\]\n\n```{r}\n#| eval: false\n#| include: false\n\ntable(raw_data_cleaned$`Deserving Group A_1`)\n\nraw_data_cleaned$block\n\nraw_data_cleaned$d_black_afam_abc\n\nraw_data_cleaned$`Deserving Group A_1`\n```\n\nLIMITED Evals: recode group specifics\n\n```{r}\n\n# Load the split mapping\nsplit_map <- read.csv(\"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/deserving split.csv\")\n\n# Loop through and rename each variable\nfor (i in 1:nrow(split_map)) {\n  \n  old_var <- split_map$var.name[i]     # e.g., \"Deserving Group A_43\"\n  new_var <- split_map$target_slug[i]  # e.g., \"d_noncit_parent_a\"\n  \n  # Just copy the values over\n  raw_data_cleaned[[new_var]] <- raw_data_cleaned[[old_var]]\n}\n\nView(raw_data_cleaned)\n```\n\n## 3. Q4 - Experiences Block\n\n```{r}\nlibrary(readr)\n\n# 0 - PREP\n\n\n\n```\n\n| Question | N   | includes    | type    |\n|----------|-----|-------------|---------|\n| Q4_1_1   |     | 0-1, 7 NAs  | numeric |\n| Q4_1_2   |     | 0-1, 7 NAs  | numeric |\n| Q4_1_3   |     | 0-1, 7 NAs  | numeric |\n| Q4_2_1   |     | 0-1, 6s NAs | numeric |\n| Q4_2_2   |     | 0-1, 6s NAs | numeric |\n| Q4_2_3   |     | 0-1, 6s NAs | numeric |\n|          |     |             |         |\n\n: Summary of Q4_1 and Q4_2\n\n```{r}\n\nview(raw_data_cleaned$Q4_1_1)\n\n# Basic Totals\n#unique(na.omit(raw_data_cleaned$Q4_1_1))\ntotal_incarcerated <- sum(raw_data_cleaned$Q4_1_1 == 1, na.rm = TRUE)\n#unique(na.omit(raw_data_cleaned$Q4_1_2))\ntotal_knows_incarcerated <- sum(raw_data_cleaned$Q4_1_2 == 1, na.rm = TRUE)\n#unique(na.omit(raw_data_cleaned$Q4_1_3))\ntotal_no_incarcerated <- sum(raw_data_cleaned$Q4_1_3 == 1, na.rm = TRUE)\n\n#unique(na.omit(raw_data_cleaned$Q4_2_1))\ntotal_victim <- sum(raw_data_cleaned$Q4_2_1 == 1, na.rm = TRUE)\n#unique(na.omit(raw_data_cleaned$Q4_2_2))\ntotal_knows_victim<- sum(raw_data_cleaned$Q4_2_2 == 1, na.rm = TRUE)\n#unique(na.omit(raw_data_cleaned$Q4_2_3))\ntotal_no_victim <- sum(raw_data_cleaned$Q4_2_3 == 1, na.rm = TRUE)\n\n#bad\n#raw_data_cleaned %>%\n#  group_by(Q4_1_1) %>%\n#  summarise(\n#    know_incarcerated = sum(Q4_1_2 == 1, na.rm = TRUE),\n#    victim = sum(Q4_2_1 == 1, na.rm = TRUE),\n#    know_victim = sum(Q4_2_2 == 1, na.rm = TRUE),\n#    n = n()\n#  )\n\n\n\n\n\n#Incarcerated Combos\nincarcerated_only <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nincarcerated_knowsinc <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\ninc_knowsinc_victim <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\ninc_knowsinc_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\n\ninc_knowsinc_victim_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nincarcerated_victim <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\ninc_victim_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nincarcerated_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\n\nknowsinc_only <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nknowsinc_victim <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nknowsinc_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nknowsinc_victim_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nvict_only <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nvictim_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nknowsvict_only <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\n#data frame\ncontact_counts <- tibble::tibble(\n  total_incarcerated = total_incarcerated,\n  total_knows_incarcerated = total_knows_incarcerated,\n  total_no_incarcerated = total_no_incarcerated,\n  total_victim = total_victim,\n  total_knows_victim = total_knows_victim,\n  total_no_victim = total_no_victim,\n  incarcerated_only = incarcerated_only,\n  incarcerated_knowsinc = incarcerated_knowsinc,\n  inc_knowsinc_victim = inc_knowsinc_victim,\n  inc_knowsinc_knowsvict = inc_knowsinc_knowsvict,\n  inc_knowsinc_victim_knowsvict = inc_knowsinc_victim_knowsvict,\n  incarcerated_victim = incarcerated_victim,\n  inc_victim_knowsvict = inc_victim_knowsvict,\n  incarcerated_knowsvict = incarcerated_knowsvict,\n  knowsinc_only = knowsinc_only,\n  knowsinc_victim = knowsinc_victim,\n  knowsinc_knowsvict = knowsinc_knowsvict,\n  knowsinc_victim_knowsvict = knowsinc_victim_knowsvict,\n  vict_only = vict_only,\n  victim_knowsvict = victim_knowsvict,\n  knowsvict_only = knowsvict_only\n)\n\nwrite_csv(contact_counts, \"filled_contact_combo_counts.csv\")\n\n\nview(contact_counts)\n\n```\n\nPOTENTIALLY DELETE BELOW\n\n```{r}\n\n```\n\n```         \n```\n\n```{r}\n#table MAYBE DELTE OR REUSE ONCE FIXED\n\nlibrary(gt)\n\ncontact_table_gt <- contact_table %>%\n  select(contact_group, n, pct_total_sample, pct_been_incarcerated, pct_know_incarcerated, pct_been_victim) %>%\n  gt() %>%\n  cols_label(\n    contact_group = \"Contact Experience\",\n    n = \"N\",\n    pct_total_sample = \"% of Total Sample\",\n    pct_been_incarcerated = \"% of Been Incarcerated Group\",\n    pct_know_incarcerated = \"% of Knows Incarcerated Group\",\n    pct_been_victim = \"% of Been Victim Group\"\n  ) %>%\n  fmt_number(columns = where(is.numeric), decimals = 1) %>%\n  tab_header(title = \"Contact Experience Distribution by Subgroup\") %>%\n  tab_options(table.font.size = \"small\")\n\ncontact_table_gt\n\n\n\n```\n\n```{r, edit_codebook_experiences}\n\n# Load existing codebook\ncodebook <- read_csv(\"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/codebook_q4.csv\")\n\n# Example: add new variable descriptions (you could repeat this pattern)\nnew_entries <- tibble(\n # variable_name = c(\"impact_score\", \"party_binary\"),\n # type = c(\"Binary (0/1)\", \"Binary (0/1)\"),\n#  values = c(\"1 = impacted, 0 = not impacted\", \"1 = Democrat, 0 = Republican\"),\n # notes = c(\"Composite variable for incarceration/victimization contact\", \"Collapsed party ID\"),\n  \n  statement_number = NA,\n  response_option_code = NA,\n  response_option = NA\n)\n\n# Combine with existing codebook\ncodebook <- bind_rows(codebook, new_entries)\n\n# (Optional) save again\nwrite_csv(codebook, \"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/codebook_q4.csv\")\n\n```\n","srcMarkdownNoYaml":"\n\n```{r setup}\n# Load packages\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(readr)\nlibrary(janitor)   # for clean_names()\nlibrary(tibble)\nlibrary(stringr)\nlibrary(gt)\n\n\n\n```\n\n## 0. Preliminary - Load Data +s Troubleshoot\n\n```{r}\n# Unzip and load data\n\nraw_data <- read_csv(\"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/data/raw/scotg_results.csv\")\n\nraw_data <- clean_names(raw_data)\n```\n\n### Create Codebook\n\n```{r}\n# Identify Q4 binary columns in the raw data\nq4_binary_cols <- names(raw_data)[str_detect(names(raw_data), \"^Q4_\\\\d+_\\\\d+$\")]\n\n# Create initial codebook with Q4 metadata\nq4_codebook <- tibble(\n  variable_name = q4_binary_cols\n) %>%\n  mutate(\n    statement_number = str_extract(variable_name, \"(?<=Q4_)\\\\d+(?=_)\"),\n    response_option_code = str_extract(variable_name, \"(?<=_)\\\\d+$\"),\n    response_option = case_when(\n      response_option_code == \"1\" ~ \"You\",\n      response_option_code == \"2\" ~ \"Someone you know well\",\n      response_option_code == \"3\" ~ \"No/Don't know\",\n      TRUE ~ NA_character_\n    ),\n    type = \"Binary (0/1)\",\n    values = \"1 = selected, 0 = not selected, NA = no response\",\n    notes = \"From Q4 matrix question (multiple selection possible)\"\n  )\n\n# Save this codebook to disk\nwrite_csv(q4_codebook, \"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/codebook_q4.csv\")\n\nx\n```\n\n#### 0a. troubleshooting to figure out how different question types exported\n\n# (Removed early troubleshooting code for block assignment using col indices 998â€“1000;\n\n# now using named columns like FL_8_DO_Deserving&PowerBlockA)\n\n## 1. Cleaning + Creating Codebook\n\n#### a. Label Deserving & Power Blocks\n\n```{r}\n\n# DeservingPower Blocks\n\n\nFL_8_DO_Deserving&PowerBlockA %in% names(raw_data)\n\n# Add participant block label (group a, b, c)\nraw_data <- raw_data %>%\n  mutate(\n    block = case_when(\n      !is.na(`FL_8_DO_Deserving&PowerBlockA`) ~ \"A\",\n      !is.na(`FL_8_DO_Deserving&PowerBlockB`) ~ \"B\",\n      !is.na(`FL_8_DO_Deserving&PowerBlockC`) ~ \"C\",\n      TRUE ~ NA_character_\n    )\n  )\n\n# Save labeled but otherwise unmodified version\nwrite_csv(raw_data, \"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/data/cleaned/labeled_raw_data.csv\")\n\n```\n\n#### b. Create cleaned data frame, deleting un-needed cols\n\n```{r}\n\ncolumns_to_drop <- c(\n  \"Status\", \"StartDate\", \"EndDate\", \"IPAddress\", \"RecipientLastName\", \"RecipientFirstName\", \n  \"RecipientEmail\", \"ExternalReference\", \"RecordedDate\", \"LocationLatitude\", \n  \"LocationLongitude\", \"DistributionChannel\", \"UserLanguage\"\n)\n\n# Drop all columns containing \"_DO\" (Display Order)\ndo_columns <- grep(\"_DO\", names(raw_data), value = TRUE)\n\n# Combine and remove\nraw_data_cleaned <- raw_data %>%\n  select(-all_of(c(columns_to_drop, do_columns)))\n\n```\n\n### c. Clean: drop non-consenters\n\n```{r}\n\n# Filter to those who consented\nraw_data_cleaned <- raw_data_cleaned %>%\n  filter(`Consent:` == 1)\n\n# Save again\nwrite_csv(raw_data_cleaned, \"data/cleaned/cleaned_data_consent.csv\")\n\n#remove consent col\n\nraw_data_cleaned <- raw_data_cleaned %>%\n  select(-`Consent:`)\n\n```\n\n### d. Clean: attn checks\n\n-   first, create flags for passed/not each check and people who failed all\n\n```{r}\n\n# 1. Individual pass/fail checks (already defined earlier in your script)\nattn_check_q9 <- raw_data_cleaned$Q9 == 4\n\nattn_text <- tolower(str_trim(raw_data_cleaned$Q17))\naccepted_variants <- c(\"purple\", \"\\\"purple\\\"\", \"purpke\", \"purplee\", \"prurprle\", \"purpl\", \"purp\", \"ðŸ’œ\", \"ðŸŸ£\")\nattn_check_q17 <- attn_text %in% accepted_variants\n\nattn_check_q1114 <- raw_data_cleaned$Q114_4 == 6\nattn_check_q1114[raw_data_cleaned$Q114_4 == -99] <- FALSE\nattn_check_q1114[is.na(raw_data_cleaned$Q114_4)] <- TRUE  # not shown â†’ pass\n\n# 2. Create score + filter full failures\nraw_data_cleaned <- raw_data_cleaned %>%\n  mutate(\n    attn_q9_pass = attn_check_q9,\n    attn_q17_pass = attn_check_q17,\n    attn_q1114_pass = attn_check_q1114,\n    attn_pass_count = as.integer(attn_q9_pass) + as.integer(attn_q17_pass) + as.integer(attn_q1114_pass)\n  ) %>%\n  filter(attn_pass_count > 0)  # Remove only people who failed all\n\n```\n\n### e. Clean: via survey duration\n\n```{r}\n\nstr(raw_data_cleaned$`Duration (in seconds)`)\n\nraw_data_cleaned$duration_sec <- as.numeric(raw_data_cleaned$`Duration (in seconds)`)\n\nraw_data_cleaned <- raw_data_cleaned %>%\n  filter(duration_sec >= 480)\n\n```\n\n### e. Clean: ppl who do not answer my IV ??\n\n```{r}\n\n\n\n```\n\n### f. Rename variables\n\n```{r}\nsummary(raw_data_cleaned)\n#party\n\n\n# let's see how it looks\ntable(original = df$gender, new = df$gender_01)\n\n```\n\n## 2. Deservingness and Power consolidation\n\nObjective: consolidate blocks (so only 1 Incarcerated People/Prisoners)\n\n```{r}\n\nmapping <- read_csv(\"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/data/Unified_Deserving_Power_Target_Mapping.csv\")\nraw_data_preserved <- raw_data_cleaned  # back up before modification\n\n\n\n```\n\nPrep by converting to numeric\n\n```{r}\n#| eval: false\n#| include: false\n# Identify all Deserving and Power columns\ndeserving_power_cols <- names(raw_data_cleaned)[str_detect(names(raw_data_cleaned), \"^(Deserving|Power) Group\")]\n\nraw_data_cleaned <- raw_data_cleaned %>%\n  mutate(across(\n    all_of(deserving_power_cols),\n    as.character\n  ))\n\nraw_data_cleaned <- raw_data_cleaned %>%\n  mutate(across(\n    all_of(deserving_power_cols),\n    ~ as.numeric(na_if(.x, \"-99\"))\n  ))\n\ntable(raw_data_cleaned$`Deserving Group A_1`, useNA = \"always\")\n\n```\n\nALL Evals: Create consolidated variable names for deservingness\n\n```{r}\n\nnew_vars <- c(\n  \"d_black_afam_abc\", \"d_native_ind_abc\", \"d_asianam_abc\", \"d_latino_his_abc\", \"d_whiteam_abc\", \n  \"d_mideastam_abc\", \"d_incwomen_abc\", \"d_collegewom_abc\", \"d_enviro_abc\", \"d_feminists_abc\", \n  \"d_proabort_choice_abc\", \"d_abortprov_abc\", \"d_welfare_tanf_abc\", \"d_fstamps_snap_abc\", \n  \"d_unions_abc\", \"d_medicaid_abc\", \"d_medicare_abc\", \"d_unemployed_abc\", \"d_police_abc\", \n  \"d_poorfam_abc\", \"d_wealthy_abc\", \"d_teachers_abc\", \"d_sci_experts_abc\", \"d_child_abc\", \n  \"d_crim_abc\", \"d_incppl_abc\", \"d_homeless_abc\", \"d_immigrants_abc\", \"d_unauth_undoc_abc\", \n  \"d_gunowners_abc\", \"d_voters_abc\", \"d_lgbt_abc\", \"d_trans_abc\", \"d_transkids_abc\", \"d_gunmans_abc\", \n  \"d_ice_abc\", \"d_socmed_abc\", \"d_nra_abc\", \"d_bigbank_abc\", \"d_bigcorp_abc\", \"d_uni_abc\", \n  \"d_comcoll_abc\", \"d_noncit_parent_a\", \"d_incparents_a\", \"d_hsteen_a\", \"d_athiest_a\", \"d_cath_a\", \n  \"d_evan_a\", \"d_jews_a\", \"d_pal_a\", \"d_muslim_a\", \"d_blackwom_a\", \"d_blackmen_a\", \"d_lds_a\", \n  \"d_longcov_a\", \"d_exon_a\", \"d_weed_a\", \"d_opioid_a\", \"d_whitecol_a\", \"d_tech_a\", \"d_smokers_a\", \n  \"d_genx_a\", \"d_boomer_a\", \"d_mill_a\", \"d_genz_a\"\n)\n\nfor (var in new_vars) {\n  raw_data_cleaned[[var]] <- NA #to initialize\n}\n\nView(raw_data_cleaned)\n\n```\n\n```{r}\n# Load the spreadsheet with the mappings\nlibrary(readxl)\nmapping <- read_excel(\"scratch for consolidation.xlsx\")\n\n# Loop through each row of the mapping\nfor (i in 1:nrow(mapping)) {\n  \n  new_var <- mapping$target_slug[i]\n  \n  # Get up to three source columns\n  cols_to_check <- c(mapping$`Deserving Group A`[i],\n                     mapping$`Deserving Group B`[i],\n                     mapping$`Deserving Group C`[i])\n  \n  # Remove any NA column names\n  cols_to_check <- cols_to_check[!is.na(cols_to_check)]\n  \n  # Consolidate non-NA and non--99 values across the 3 group columns\n  raw_data_cleaned[[new_var]] <- apply(\n    raw_data_cleaned[ , cols_to_check], 1, function(row) {\n      # Filter out NA and -99\n      val <- row[!is.na(row) & row != -99]\n      if (length(val) > 0) val[1] else NA  # take first valid value\n    }\n  )\n}\nc)\n\n```\n\ncheck that this worked. want to:\n\n-   EX: for observation \\[response ID\\] \\[R_7oC8AaiF6X3vmsT\\], IF they have non-NA, non -99 value in \\[Deserving Group A_1\\]\n\n    -   then they should also have \"A\" in block variable\n\n    -   the value of \\[d_black_afam_abc\\] should be = to the value of \\[Deserving Group A_1\\]\n\n```{r}\n#| eval: false\n#| include: false\n\ntable(raw_data_cleaned$`Deserving Group A_1`)\n\nraw_data_cleaned$block\n\nraw_data_cleaned$d_black_afam_abc\n\nraw_data_cleaned$`Deserving Group A_1`\n```\n\nLIMITED Evals: recode group specifics\n\n```{r}\n\n# Load the split mapping\nsplit_map <- read.csv(\"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/deserving split.csv\")\n\n# Loop through and rename each variable\nfor (i in 1:nrow(split_map)) {\n  \n  old_var <- split_map$var.name[i]     # e.g., \"Deserving Group A_43\"\n  new_var <- split_map$target_slug[i]  # e.g., \"d_noncit_parent_a\"\n  \n  # Just copy the values over\n  raw_data_cleaned[[new_var]] <- raw_data_cleaned[[old_var]]\n}\n\nView(raw_data_cleaned)\n```\n\n## 3. Q4 - Experiences Block\n\n```{r}\nlibrary(readr)\n\n# 0 - PREP\n\n\n\n```\n\n| Question | N   | includes    | type    |\n|----------|-----|-------------|---------|\n| Q4_1_1   |     | 0-1, 7 NAs  | numeric |\n| Q4_1_2   |     | 0-1, 7 NAs  | numeric |\n| Q4_1_3   |     | 0-1, 7 NAs  | numeric |\n| Q4_2_1   |     | 0-1, 6s NAs | numeric |\n| Q4_2_2   |     | 0-1, 6s NAs | numeric |\n| Q4_2_3   |     | 0-1, 6s NAs | numeric |\n|          |     |             |         |\n\n: Summary of Q4_1 and Q4_2\n\n```{r}\n\nview(raw_data_cleaned$Q4_1_1)\n\n# Basic Totals\n#unique(na.omit(raw_data_cleaned$Q4_1_1))\ntotal_incarcerated <- sum(raw_data_cleaned$Q4_1_1 == 1, na.rm = TRUE)\n#unique(na.omit(raw_data_cleaned$Q4_1_2))\ntotal_knows_incarcerated <- sum(raw_data_cleaned$Q4_1_2 == 1, na.rm = TRUE)\n#unique(na.omit(raw_data_cleaned$Q4_1_3))\ntotal_no_incarcerated <- sum(raw_data_cleaned$Q4_1_3 == 1, na.rm = TRUE)\n\n#unique(na.omit(raw_data_cleaned$Q4_2_1))\ntotal_victim <- sum(raw_data_cleaned$Q4_2_1 == 1, na.rm = TRUE)\n#unique(na.omit(raw_data_cleaned$Q4_2_2))\ntotal_knows_victim<- sum(raw_data_cleaned$Q4_2_2 == 1, na.rm = TRUE)\n#unique(na.omit(raw_data_cleaned$Q4_2_3))\ntotal_no_victim <- sum(raw_data_cleaned$Q4_2_3 == 1, na.rm = TRUE)\n\n#bad\n#raw_data_cleaned %>%\n#  group_by(Q4_1_1) %>%\n#  summarise(\n#    know_incarcerated = sum(Q4_1_2 == 1, na.rm = TRUE),\n#    victim = sum(Q4_2_1 == 1, na.rm = TRUE),\n#    know_victim = sum(Q4_2_2 == 1, na.rm = TRUE),\n#    n = n()\n#  )\n\n\n\n\n\n#Incarcerated Combos\nincarcerated_only <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nincarcerated_knowsinc <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\ninc_knowsinc_victim <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\ninc_knowsinc_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\n\ninc_knowsinc_victim_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nincarcerated_victim <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\ninc_victim_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nincarcerated_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 1 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\n\nknowsinc_only <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nknowsinc_victim <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nknowsinc_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 0 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nknowsinc_victim_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 1 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nvict_only <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nvictim_knowsvict <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 1 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\nknowsvict_only <- sum(\n  raw_data_cleaned$Q4_1_1 == 0 &\n  raw_data_cleaned$Q4_1_2 == 0 &\n  raw_data_cleaned$Q4_1_3 == 0 &\n  raw_data_cleaned$Q4_2_1 == 1 &\n  raw_data_cleaned$Q4_2_2 == 0 &\n  raw_data_cleaned$Q4_2_3 == 0 &\n  !is.na(raw_data_cleaned$Q4_1_1) &\n  !is.na(raw_data_cleaned$Q4_1_2) &\n  !is.na(raw_data_cleaned$Q4_1_3) &\n  !is.na(raw_data_cleaned$Q4_2_1) &\n  !is.na(raw_data_cleaned$Q4_2_2) &\n  !is.na(raw_data_cleaned$Q4_2_3)\n)\n\n#data frame\ncontact_counts <- tibble::tibble(\n  total_incarcerated = total_incarcerated,\n  total_knows_incarcerated = total_knows_incarcerated,\n  total_no_incarcerated = total_no_incarcerated,\n  total_victim = total_victim,\n  total_knows_victim = total_knows_victim,\n  total_no_victim = total_no_victim,\n  incarcerated_only = incarcerated_only,\n  incarcerated_knowsinc = incarcerated_knowsinc,\n  inc_knowsinc_victim = inc_knowsinc_victim,\n  inc_knowsinc_knowsvict = inc_knowsinc_knowsvict,\n  inc_knowsinc_victim_knowsvict = inc_knowsinc_victim_knowsvict,\n  incarcerated_victim = incarcerated_victim,\n  inc_victim_knowsvict = inc_victim_knowsvict,\n  incarcerated_knowsvict = incarcerated_knowsvict,\n  knowsinc_only = knowsinc_only,\n  knowsinc_victim = knowsinc_victim,\n  knowsinc_knowsvict = knowsinc_knowsvict,\n  knowsinc_victim_knowsvict = knowsinc_victim_knowsvict,\n  vict_only = vict_only,\n  victim_knowsvict = victim_knowsvict,\n  knowsvict_only = knowsvict_only\n)\n\nwrite_csv(contact_counts, \"filled_contact_combo_counts.csv\")\n\n\nview(contact_counts)\n\n```\n\nPOTENTIALLY DELETE BELOW\n\n```{r}\n\n```\n\n```         \n```\n\n```{r}\n#table MAYBE DELTE OR REUSE ONCE FIXED\n\nlibrary(gt)\n\ncontact_table_gt <- contact_table %>%\n  select(contact_group, n, pct_total_sample, pct_been_incarcerated, pct_know_incarcerated, pct_been_victim) %>%\n  gt() %>%\n  cols_label(\n    contact_group = \"Contact Experience\",\n    n = \"N\",\n    pct_total_sample = \"% of Total Sample\",\n    pct_been_incarcerated = \"% of Been Incarcerated Group\",\n    pct_know_incarcerated = \"% of Knows Incarcerated Group\",\n    pct_been_victim = \"% of Been Victim Group\"\n  ) %>%\n  fmt_number(columns = where(is.numeric), decimals = 1) %>%\n  tab_header(title = \"Contact Experience Distribution by Subgroup\") %>%\n  tab_options(table.font.size = \"small\")\n\ncontact_table_gt\n\n\n\n```\n\n```{r, edit_codebook_experiences}\n\n# Load existing codebook\ncodebook <- read_csv(\"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/codebook_q4.csv\")\n\n# Example: add new variable descriptions (you could repeat this pattern)\nnew_entries <- tibble(\n # variable_name = c(\"impact_score\", \"party_binary\"),\n # type = c(\"Binary (0/1)\", \"Binary (0/1)\"),\n#  values = c(\"1 = impacted, 0 = not impacted\", \"1 = Democrat, 0 = Republican\"),\n # notes = c(\"Composite variable for incarceration/victimization contact\", \"Collapsed party ID\"),\n  \n  statement_number = NA,\n  response_option_code = NA,\n  response_option = NA\n)\n\n# Combine with existing codebook\ncodebook <- bind_rows(codebook, new_entries)\n\n# (Optional) save again\nwrite_csv(codebook, \"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/codebook_q4.csv\")\n\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":true,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"produce-source-notebook":true,"notebook-preserve-cells":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"data_prep.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.544","manuscript":{"article":"index-draft.qmd","notebooks":[{"notebook":"scratch.qmd"},{"notebook":"saveh3h4cut.qmd"},{"notebook":"index-draft-backup-415.qmd"},{"notebook":"feedback_language.qmd"},{"notebook":"slides/april-presentation.qmd"},{"notebook":"hyp_language.qmd"},{"notebook":"data_prep.qmd"},{"notebook":"other_scratch.qmd"},{"notebook":"old methods.qmd"},{"notebook":"scratchapril14.qmd"},{"notebook":"testrender.Rmd"},{"notebook":"test.qmd"},{"notebook":"index-draft.qmd","title":"Article Notebook"}],"mecaFile":"index-draft-meca.zip"},"resources":["april-presentation.qmd"],"editor":"visual","quarto-internal":{"subarticles":[{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/index-draft.qmd","token":"nb-article","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/scratch.qmd","token":"nb-1","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/saveh3h4cut.qmd","token":"nb-2","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/index-draft-backup-415.qmd","token":"nb-3","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/feedback_language.qmd","token":"nb-4","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/slides/april-presentation.qmd","token":"nb-5","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/hyp_language.qmd","token":"nb-6","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/data_prep.qmd","token":"nb-7","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/other_scratch.qmd","token":"nb-8","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/old methods.qmd","token":"nb-9","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/scratchapril14.qmd","token":"nb-10","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/testrender.Rmd","token":"nb-11","render":true},{"input":"/Users/kristinamensik/Documents/Duke/2024-2025/902 Legislators Pre-Ananlysis Plan/Prelim Folder/Prelim 3-23/test.qmd","token":"nb-12","render":true}]},"notebook-preview-options":{"back":true},"theme":"cosmo","title-block-style":"manuscript","lightbox":"auto","comments":{"hypothesis":true},"title":"data_prep","clear-hidden-classes":"none","remove-hidden":"all","unroll-markdown-cells":true},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html","docx","jats"]}
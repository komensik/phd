"0","library(readxl)"
"0","library(stringr)"
"0","library(dplyr)"
"0",""
"0",""
"0","# Load the mapping"
"0","mapping <- read_excel(""scratch for consolidation.xlsx"")"
"0","view(mapping)"
"0",""
"0","# Clean column names and values in mapping to match raw_data_cleaned"
"0","mapping <- mapping %>%"
"0","  rename("
"0","    var_a = `Deserving Group A`,"
"0","    var_b = `Deserving Group B`,"
"0","    var_c = `Deserving Group C`"
"0","  ) %>%"
"0","  mutate("
"0","    var_a = str_replace_all(tolower(trimws(var_a)), "" "", ""_""),"
"0","    var_b = str_replace_all(tolower(trimws(var_b)), "" "", ""_""),"
"0","    var_c = str_replace_all(tolower(trimws(var_c)), "" "", ""_"")"
"0","  )"
"0",""
"0","# Create consolidated variables"
"0","for (i in 1:nrow(mapping)) {"
"0","  new_var <- mapping$target_slug[i]"
"0","  var_a <- mapping$var_a[i]"
"0","  var_b <- mapping$var_b[i]"
"0","  var_c <- mapping$var_c[i]"
"0","  "
"0","  # Optional check"
"0","  if (!all(c(var_a, var_b, var_c) %in% names(raw_data_cleaned))) {"
"0","    warning(paste(""Missing column(s) for:"", new_var))"
"0","  }"
"0",""
"0","  raw_data_cleaned[[new_var]] <- dplyr::case_when("
"0","  raw_data_cleaned$block == ""A"" ~ as.numeric(raw_data_cleaned[[var_a]]),"
"0","  raw_data_cleaned$block == ""B"" ~ as.numeric(raw_data_cleaned[[var_b]]),"
"0","  raw_data_cleaned$block == ""C"" ~ as.numeric(raw_data_cleaned[[var_c]]),"
"0","  TRUE ~ NA_real_"
"0",")"
"0","}"
"0",""
"0","#verify: "
"0",""
"0","raw_data_cleaned %>%"
"0","  select(block, deserving_group_a_26, d_incppl_pris_abc) %>%"
"0","  filter(block == ""A"") %>%"
"0","  slice(1:10)"
